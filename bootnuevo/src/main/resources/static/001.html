<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript" src="jquery-3.6.0.min.js"></script>
<script type="text/javascript">


//las funciones ligadas a la pantalla
function generarTabla(libros) {
	
	 $("table").empty();
	
	for (var i=0;i<libros.length;i++) {
		let fila=libros[i];	
		$("table").append(`<tr>
							 <td>${fila.isbn}</td>
							  <td>${fila.titulo}</td>
							  <td>${fila.autor}</td>
							  <td><input type="button" onClick="pulsarBorrar(${fila.isbn})" value="borrar elemento"/></td>
							  </tr>`);
	}
	
}

function pulsarBorrar(isbn) {
	
		borrar(isbn).then(buscarTodos).then(function(libros) {
			
			generarTabla(libros);
		})
	
}



// dejo las funciones de Ajax

function borrar(isbn) {
	
	return $.ajax({
	    url: `http://localhost:8080/webapi/libros/${isbn}`,
	    type: 'DELETE'});
	
	
}

function buscarTodos() {
	
	// es una funcion que devuelve un valor
	// y ese valor solo tendra contenido en un futuro
	// cuando el objeto quede relleno de la petición ajax
	console.log("entra buscar todos");
	return $.get("http://localhost:8080/webapi/libros");
	
	
}

function insertar(libro) {
	
	return $.ajax({
        type: "POST",
        url: "http://localhost:8080/webapi/libros",
        contentType:"application/json",
        data: JSON.stringify(libro)
    });
	
}

$(document).ready(function() {

	$("#formularionuevo").hide();
	
	// devuelve una variable con datos
	
	let promesaAjax=buscarTodos();
	
	promesaAjax.then(function(libros) {
		
		generarTabla(libros);
	})
	
	$("#botonformularionuevo").click(function() {
		$("#lista").hide();
		$("#formularionuevo").show();
		
	})
	
	$("#salvar").click(function() {
	
		let objeto={}
		objeto.isbn= $("#isbn").val();
		objeto.titulo= $("#titulo").val();
		objeto.autor= $("#autor").val();
	
		
		insertar(objeto).then(buscarTodos).then(function(libros) {
		
			$("#lista").show();
			$("#formularionuevo").hide();
			generarTabla(libros);
		
			
		})
			
	})
	
	
})
</script>
</head>
<body>
	<div id="lista">

		<table>

		</table>
		<input type="button" id="botonformularionuevo" value="añadir"/>
	</div>
	<div id="formularionuevo">

		<form>

			<p>
				ISBN: <input type="text" id="isbn" name="isbn" />
			</p>
			<p>
				titulo: <input type="text" id="titulo" name="titulo" />
			</p>
			<p>
				autor: <input type="text" id="autor" name="autor" />
			</p>
			<input type="button" id="salvar" value="salvar" />


		</form>
	</div>
</body>
</html>
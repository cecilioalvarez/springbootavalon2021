<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<script type="text/javascript" src="jquery-3.6.0.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript">

	//Funciones ligadas a la pantalla
	function generarTabla(libros){
		
		$("table").empty();
		
		for(var i=0; i<libros.length; i++){
			let fila = libros[i];
			$("table").append(`<tr>
				<td>${fila.isbn}</td>
				<td>${fila.titulo}</td>
				<td>${fila.autor}</td>
				<td><input type="button" onClick="pulsarBorrar(${fila.isbn})" value="borrar elemento"/></td>
				</tr>`);
		}
	}
	
	function pulsarBorrar(isbn){
		borrar(isbn).then(buscarTodos).then(function(libros) {
			generarTabla(libros);
		});
	}
	
	
	//Funciones Ajax
	function borrar(isbn){
		return $.ajax({
			url: `http://localhost:8080/webapi/libros/${isbn}`,
			type: 'DELETE'});
	}
	
	function buscarTodos(){
		return $.get("http://localhost:8080/webapi/libros");
	}
	
	function insertar(libro){
		return $.ajax({
	        type: "POST",
	        url: "http://localhost:8080/webapi/libros",
	        //dataType: "json",
	        contentType:"application/json",
	        data: JSON.stringify(libro)
	    });
	}
	
	$(document).ready(function(){
		
		//cuando se cargue la pagina el formulario se ocultara
		$("#formularionuevo").hide();
		
		//Devolvemos una variable con datos 
		let promesaAjax = buscarTodos();
		
		promesaAjax.then(function(libros){
			generarTabla(libros);
		})
		
		$("#botonformularionuevo").click(function(){
			$("#lista").hide();
			$("#formularionuevo").show();
		})
		
		$("#salvar").click(function(){
			
			let objeto = {}
			objeto.isbn = $("#isbn").val();
			objeto.titulo = $("#titulo").val();
			objeto.autor = $("#autor").val();
			console.log(objeto);
			
			insertar(objeto).then(buscarTodos).then(function(libros){
				$("#lista").show();
				$("#formularionuevo").hide();
				generarTabla(libros);
			})
		})
	})
	
	
</script>
</head>
<body>

	<div id="lista">
		<table>
		</table>
		<input type="button" id="botonformularionuevo" value="Añadir">
	</div>
	
	<div id="formularionuevo">
		<form action="">
			<p>
				ISBN: <input type="text" id="isbn" name="isbn" />
			</p>
			<p>
				titulo: <input type="text" id="titulo" name="titulo" />
			</p>
			<p>
				autor: <input type="text" id="autor" name="autor" />
			</p>
			<input type="button" id="salvar" value="salvar" />
		</form>
	</div>
	
</body>
</html>